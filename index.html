<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Trading Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --black: #000000;
            --white: #ffffff;
            --red: #dc3545;
            --green: #198754;
            --gray-dark: #212529;
            --gray-light: #f8f9fa;
        }
        
        body {
            background-color: var(--black);
            color: var(--white);
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        
        .dashboard-header {
            background-color: var(--gray-dark);
            border-bottom: 1px solid #333;
            padding: 1rem 0;
        }
        
        .status-indicator {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 600;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .status-buy {
            background-color: rgba(25, 135, 84, 0.2);
            border: 1px solid var(--green);
            color: var(--green);
        }
        
        .status-sell {
            background-color: rgba(220, 53, 69, 0.2);
            border: 1px solid var(--red);
            color: var(--red);
        }
        
        .status-prepare {
            background-color: rgba(255, 193, 7, 0.2);
            border: 1px solid #ffc107;
            color: #ffc107;
        }
        
        .status-wait {
            background-color: rgba(108, 117, 125, 0.2);
            border: 1px solid #6c757d;
            color: #6c757d;
        }
        
        .card {
            background-color: var(--gray-dark);
            border: 1px solid #333;
            color: var(--white);
            margin-bottom: 1.5rem;
        }
        
        .card-header {
            background-color: rgba(0, 0, 0, 0.5);
            border-bottom: 1px solid #333;
            font-weight: 600;
        }
        
        .news-item {
            border-bottom: 1px solid #333;
            padding: 1rem 0;
            transition: background-color 0.2s;
        }
        
        .news-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .news-item:last-child {
            border-bottom: none;
        }
        
        .news-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .news-source {
            color: #aaa;
            font-size: 0.875rem;
        }
        
        .strategy-item {
            margin-bottom: 1rem;
            padding: 1rem;
            border-left: 3px solid var(--green);
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .time-slot {
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: 0.375rem;
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .time-active {
            border-left: 4px solid var(--green);
        }
        
        .time-inactive {
            border-left: 4px solid #6c757d;
        }
        
        .badge-green {
            background-color: var(--green);
        }
        
        .badge-red {
            background-color: var(--red);
        }
        
        .last-updated {
            color: #aaa;
            font-size: 0.875rem;
            text-align: right;
        }
        
        .news-badge {
            font-size: 0.7rem;
            margin-left: 0.5rem;
        }
        
        .api-status {
            font-size: 0.75rem;
            color: #6c757d;
        }
        
        .api-success {
            color: var(--green);
        }
        
        .api-error {
            color: var(--red);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="dashboard-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h1 class="h3 mb-0">Bitcoin Trading Dashboard</h1>
                    <p class="mb-0 text-white">Real-time insights for strategic trading</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <div id="current-time" class="h5 mb-1"></div>
                    <div id="trading-status" class="status-indicator status-wait">Analyzing market conditions...</div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container my-4">
        <div class="row">
            <!-- Trading Strategy & Times -->
            <div class="col-lg-4">
                <!-- Trading Strategy -->
                <div class="card">
                    <div class="card-header">
                        Trading Strategy
                    </div>
                    <div class="card-body">
                        <div class="strategy-item">
                            <h5>Entry Conditions</h5>
                            <ul class="mb-0">
                                <li>RSI â‰¤ 30 on 15-min chart</li>
                                <li>5-min, 15-min & 1hr bullish alignment</li>
                                <li>EMA 20 > EMA 50 on all timeframes</li>
                                <li>Green candle forms with volume increase</li>
                            </ul>
                        </div>
                        
                        <div class="strategy-item">
                            <h5>Exit Conditions</h5>
                            <ul class="mb-0">
                                <li>RSI reaches 65-80 range</li>
                                <li>0.5% profit target achieved</li>
                                <li>Stop loss triggered at 0.3-0.4%</li>
                            </ul>
                        </div>
                        
                        <div class="strategy-item">
                            <h5>Risk Management</h5>
                            <ul class="mb-0">
                                <li>0.3-0.4% risk per trade</li>
                                <li>Max 2-5 trades per day</li>
                                <li>Max $3 daily loss limit</li>
                                <li>Position sizing based on signal quality</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Trading Times -->
                <div class="card">
                    <div class="card-header">
                        Optimal Trading Times (PH Time)
                    </div>
                    <div class="card-body">
                        <div class="time-slot time-active" id="london-session">
                            <div class="d-flex justify-content-between">
                                <strong>London Open</strong>
                                <span class="badge badge-green">ACTIVE</span>
                            </div>
                            <div>4:00 PM - 7:00 PM</div>
                            <small class="text-white">Highest volatility & direction</small>
                        </div>
                        
                        <div class="time-slot" id="us-session">
                            <div class="d-flex justify-content-between">
                                <strong>US Open</strong>
                                <span class="badge bg-secondary">INACTIVE</span>
                            </div>
                            <div>9:00 PM - 12:00 AM</div>
                            <small class="text-white">Good momentum moves</small>
                        </div>
                        
                        <div class="time-slot" id="asian-session">
                            <div class="d-flex justify-content-between">
                                <strong>Asian Session</strong>
                                <span class="badge bg-secondary">INACTIVE</span>
                            </div>
                            <div>8:00 AM - 12:00 PM</div>
                            <small class="text-white">Avoid - low liquidity</small>
                        </div>
                        
                        <div class="mt-3">
                            <small class="text-white">Best trading days: Tuesday - Thursday</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- News Feed -->
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span>Impactful Trading News</span>
                        <div>
                            <span class="api-status me-2">APIs: <span id="api-status-count">0/7</span></span>
                            <button id="refresh-news" class="btn btn-sm btn-outline-light">Refresh News</button>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div id="news-container">
                            <!-- News items will be loaded here -->
                            <div class="text-center p-4">
                                <div class="spinner-border text-light" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-2">Loading latest news from multiple sources...</p>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer">
                        <div class="last-updated">
                            Last updated: <span id="last-updated-time">--</span>
                            | News sources: <span id="news-sources">--</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // News APIs configuration
        const NEWS_APIS = [
            {
                name: "CryptoCompare",
                url: "https://min-api.cryptocompare.com/data/v2/news/?lang=EN&categories=BTC,ETH,Blockchain&excludeCategories=Sponsored",
                apiKey: "c8d9259b6f5a4d6f5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c",
                transform: (data) => data.Data.map(item => ({
                    title: item.title,
                    url: item.url,
                    source: item.source,
                    publishedAt: new Date(item.published_on * 1000),
                    description: item.body
                }))
            },
            {
                name: "NewsAPI (Crypto)",
                url: "https://newsapi.org/v2/everything?q=bitcoin+crypto+blockchain&sortBy=publishedAt&language=en&pageSize=10",
                apiKey: "c8d9259b6f5a4d6f5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c",
                transform: (data) => data.articles.map(item => ({
                    title: item.title,
                    url: item.url,
                    source: item.source.name,
                    publishedAt: new Date(item.publishedAt),
                    description: item.description
                }))
            },
            {
                name: "Blockchain News",
                url: "https://newsdata.io/api/1/news?apikey=pub_2012369b8b5b5c5c5c5c5c5c5c5c5c5c5c5c&q=cryptocurrency&language=en",
                apiKey: "pub_2012369b8b5b5c5c5c5c5c5c5c5c5c5c5c5c",
                transform: (data) => data.results.map(item => ({
                    title: item.title,
                    url: item.link,
                    source: item.source_id,
                    publishedAt: new Date(item.pubDate),
                    description: item.description
                }))
            },
            {
                name: "CoinGecko",
                url: "https://api.coingecko.com/api/v3/news",
                apiKey: null, // No API key needed
                transform: (data) => data.map(item => ({
                    title: item.title,
                    url: item.url,
                    source: "CoinGecko",
                    publishedAt: new Date(item.updated_at),
                    description: item.description
                }))
            },
            {
                name: "Reddit Crypto",
                url: "https://www.reddit.com/r/CryptoCurrency/hot.json?limit=15",
                apiKey: null,
                transform: (data) => data.data.children.map(item => ({
                    title: item.data.title,
                    url: `https://reddit.com${item.data.permalink}`,
                    source: "Reddit r/CryptoCurrency",
                    publishedAt: new Date(item.data.created_utc * 1000),
                    description: item.data.selftext.substring(0, 200)
                }))
            },
            {
                name: "Reddit Bitcoin",
                url: "https://www.reddit.com/r/Bitcoin/hot.json?limit=10",
                apiKey: null,
                transform: (data) => data.data.children.map(item => ({
                    title: item.data.title,
                    url: `https://reddit.com${item.data.permalink}`,
                    source: "Reddit r/Bitcoin",
                    publishedAt: new Date(item.data.created_utc * 1000),
                    description: item.data.selftext.substring(0, 200)
                }))
            },
            {
                name: "CryptoPanic",
                url: "https://cryptopanic.com/api/v1/posts/?auth_token=demo&kind=news",
                apiKey: "demo",
                transform: (data) => data.results.map(item => ({
                    title: item.title,
                    url: item.url,
                    source: item.source.title,
                    publishedAt: new Date(item.published_at),
                    description: item.metadata?.description || ""
                }))
            }
        ];

        // Global news storage
        let allNews = [];
        let successfulAPIs = 0;

        // Current time and status updates
        function updateTimeAndStatus() {
            const now = new Date();
            const phTime = new Date(now.getTime() + (8 * 60 * 60 * 1000)); // UTC+8 for PH Time
            const hours = phTime.getUTCHours();
            const minutes = phTime.getUTCMinutes().toString().padStart(2, '0');
            
            // Format time for display
            document.getElementById('current-time').textContent = 
                `PH Time: ${hours}:${minutes}`;
            
            // Update trading status based on time
            const statusElement = document.getElementById('trading-status');
            
            // Trading session logic
            if ((hours >= 16 && hours < 19) || (hours >= 21 && hours < 24)) {
                // Active trading sessions (4PM-7PM, 9PM-12AM)
                if (hours >= 16 && hours < 19) {
                    statusElement.className = 'status-indicator status-buy';
                    statusElement.textContent = 'ACTIVE: London Session - Look for RSI buy setups';
                } else {
                    statusElement.className = 'status-indicator status-prepare';
                    statusElement.textContent = 'ACTIVE: US Session - Prepare for momentum moves';
                }
            } else if (hours >= 8 && hours < 12) {
                // Asian session - avoid
                statusElement.className = 'status-indicator status-wait';
                statusElement.textContent = 'INACTIVE: Asian Session - Avoid trading, low liquidity';
            } else {
                // Outside trading hours
                statusElement.className = 'status-indicator status-wait';
                statusElement.textContent = 'MARKET CLOSED: Wait for next trading session';
            }
            
            // Update session badges
            updateSessionBadges(hours);
        }
        
        function updateSessionBadges(hours) {
            const londonSession = document.getElementById('london-session');
            const usSession = document.getElementById('us-session');
            const asianSession = document.getElementById('asian-session');
            
            // Reset all
            londonSession.className = 'time-slot time-inactive';
            usSession.className = 'time-slot time-inactive';
            asianSession.className = 'time-slot time-inactive';
            
            // Update badges
            if (hours >= 16 && hours < 19) {
                londonSession.className = 'time-slot time-active';
                londonSession.querySelector('.badge').className = 'badge badge-green';
                londonSession.querySelector('.badge').textContent = 'ACTIVE';
            } else if (hours >= 21 || hours < 1) {
                usSession.className = 'time-slot time-active';
                usSession.querySelector('.badge').className = 'badge badge-green';
                usSession.querySelector('.badge').textContent = 'ACTIVE';
            } else if (hours >= 8 && hours < 12) {
                asianSession.className = 'time-slot time-active';
                asianSession.querySelector('.badge').className = 'badge badge-red';
                asianSession.querySelector('.badge').textContent = 'AVOID';
            }
        }
        
        // Fetch news from a single API
        async function fetchFromAPI(apiConfig) {
            try {
                let url = apiConfig.url;
                
                // Add API key if needed (for demonstration, using placeholder keys)
                if (apiConfig.apiKey && apiConfig.apiKey !== 'demo') {
                    url += url.includes('?') ? '&' : '?';
                    url += `apiKey=${apiConfig.apiKey}`;
                }
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                const newsItems = apiConfig.transform(data);
                
                successfulAPIs++;
                document.getElementById('api-status-count').textContent = `${successfulAPIs}/${NEWS_APIS.length}`;
                document.getElementById('api-status-count').className = successfulAPIs > 0 ? 'api-success' : 'api-error';
                
                return newsItems;
            } catch (error) {
                console.warn(`Failed to fetch from ${apiConfig.name}:`, error);
                return [];
            }
        }
        
        // Fetch news from all APIs
        async function fetchAllNews() {
            const newsContainer = document.getElementById('news-container');
            const lastUpdatedTime = document.getElementById('last-updated-time');
            
            // Reset counters
            allNews = [];
            successfulAPIs = 0;
            
            try {
                // Show loading state
                newsContainer.innerHTML = `
                    <div class="text-center p-4">
                        <div class="spinner-border text-light" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-2">Loading news from multiple sources... <span id="api-progress">0/${NEWS_APIS.length}</span></p>
                    </div>
                `;
                
                // Fetch from all APIs in parallel
                const apiPromises = NEWS_APIS.map(api => fetchFromAPI(api));
                const results = await Promise.allSettled(apiPromises);
                
                // Combine all successful results
                results.forEach((result, index) => {
                    if (result.status === 'fulfilled' && result.value.length > 0) {
                        const apiName = NEWS_APIS[index].name;
                        const newsWithSource = result.value.map(item => ({
                            ...item,
                            apiSource: apiName
                        }));
                        allNews.push(...newsWithSource);
                    }
                });
                
                // Sort by date (newest first) and remove duplicates
                allNews.sort((a, b) => b.publishedAt - a.publishedAt);
                allNews = removeDuplicateNews(allNews);
                
                // Limit to 20 news items
                allNews = allNews.slice(0, 20);
                
                // Update last updated time
                const now = new Date();
                lastUpdatedTime.textContent = now.toLocaleTimeString();
                
                // Update news sources count
                const sources = [...new Set(allNews.map(item => item.apiSource))];
                document.getElementById('news-sources').textContent = sources.join(', ');
                
                // Display news
                displayNews();
                
            } catch (error) {
                console.error('Error fetching news:', error);
                newsContainer.innerHTML = `
                    <div class="p-3 text-center text-danger">
                        Failed to load news. Please try again later.
                    </div>
                `;
            }
        }
        
        // Remove duplicate news based on title similarity
        function removeDuplicateNews(newsArray) {
            const seen = new Set();
            return newsArray.filter(item => {
                // Create a simplified title for comparison
                const simpleTitle = item.title.toLowerCase()
                    .replace(/[^\w\s]/g, '')
                    .replace(/\s+/g, ' ')
                    .trim();
                
                if (seen.has(simpleTitle)) {
                    return false;
                }
                seen.add(simpleTitle);
                return true;
            });
        }
        
        // Display news in the container
        function displayNews() {
            const newsContainer = document.getElementById('news-container');
            
            if (allNews.length === 0) {
                newsContainer.innerHTML = '<div class="p-3 text-center">No news available at the moment.</div>';
                return;
            }
            
            newsContainer.innerHTML = '';
            
            allNews.forEach((item, index) => {
                const newsItem = document.createElement('div');
                newsItem.className = 'news-item px-3';
                
                const title = item.title || 'No title available';
                const source = item.source || 'Unknown source';
                const url = item.url || '#';
                const publishedAt = item.publishedAt.toLocaleString();
                const apiSource = item.apiSource || 'Unknown API';
                
                // Determine sentiment based on keywords
                const positiveKeywords = ['bullish', 'surge', 'rally', 'gain', 'positive', 'adoption', 'institutional'];
                const negativeKeywords = ['bearish', 'crash', 'drop', 'loss', 'negative', 'regulation', 'ban'];
                
                const titleLower = title.toLowerCase();
                let sentiment = 'neutral';
                let sentimentIcon = 'âšª';
                
                if (positiveKeywords.some(keyword => titleLower.includes(keyword))) {
                    sentiment = 'positive';
                    sentimentIcon = 'ðŸŸ¢';
                } else if (negativeKeywords.some(keyword => titleLower.includes(keyword))) {
                    sentiment = 'negative';
                    sentimentIcon = 'ðŸ”´';
                }
                
                newsItem.innerHTML = `
                    <div class="news-title">
                        ${sentimentIcon} 
                        <a href="${url}" target="_blank" class="text-white text-decoration-none">${title}</a>
                        <span class="badge bg-secondary news-badge">${apiSource}</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="news-source">${source}</span>
                        <span class="text-white">${publishedAt}</span>
                    </div>
                    ${item.description ? `<div class="mt-2 text-white small">${item.description.substring(0, 150)}...</div>` : ''}
                `;
                
                newsContainer.appendChild(newsItem);
            });
        }
        
        // Manual news refresh
        document.getElementById('refresh-news').addEventListener('click', fetchAllNews);
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Set up time updates
            updateTimeAndStatus();
            setInterval(updateTimeAndStatus, 60000); // Update every minute
            
            // Load initial news
            fetchAllNews();
            
            // Auto-refresh news every 10 minutes
            setInterval(fetchAllNews, 600000);
        });
    </script>
</body>
</html>
